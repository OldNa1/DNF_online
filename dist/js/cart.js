"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}require(["require.config"],function(){require(["template","header","footer"],function(t,u){new(function(){function e(){_classCallCheck(this,e),this.aCheck=document.querySelectorAll(".allCheck"),this.n=0,this.init()}return _createClass(e,[{key:"init",value:function(){var e=localStorage.getItem("cart");e?(e=JSON.parse(e),this.render(e)):alert("购物车为空，你也太没牌面了"),this.check=Array.from(document.querySelectorAll(".check")),this.bindEvents(),this.allMoney()}},{key:"render",value:function(e){$("#shop-list").html(t("cart-template",{data:e})),Array.from(document.querySelectorAll("#subtotal")).forEach(function(e){e.innerHTML=Number(e.innerHTML).toFixed(2)})}},{key:"bindEvents",value:function(){var o=this;$("#left").on("click","#reduceNum",function(e){var t=e.target,n=$(t).next().val();--n<1&&(n=1),$(t).next().val(n);var r=$(t).parent().prev().children("#price").html(),a=Number(n)*Number(r);$(t).parent().next().children("#subtotal").html(a.toFixed(2));var c=localStorage.getItem("cart");c=JSON.parse(c);var l=Number($(t).parent().parent().attr("data-id")),i=-1;c.some(function(e,t){return i=t,e.id===l})&&(c[i].num--,localStorage.setItem("cart",JSON.stringify(c))),u.calcCartNum(),o.allMoney()}),$("#left").on("click","#addNum",function(e){var t=e.target,n=$(t).prev().val();n++,$(t).prev().val(n);var r=$(t).parent().prev().children("#price").html(),a=Number(n)*Number(r);$(t).parent().next().children("#subtotal").html(a.toFixed(2));var c=localStorage.getItem("cart");c=JSON.parse(c);var l=Number($(t).parent().parent().attr("data-id")),i=-1;c.some(function(e,t){return i=t,e.id===l})&&(c[i].num++,localStorage.setItem("cart",JSON.stringify(c))),u.calcCartNum(),o.allMoney()}),$("#left").on("click","#delete",function(e){var t=e.target,n=$(t).parent().parent();if(confirm("你真的不要我了吗")){var r=Number($(n).attr("data-id")),a=localStorage.getItem("cart");a=JSON.parse(a);var c=-1;a.some(function(e,t){return c=t,e.id===r})&&($(n).remove(),a=a.filter(function(e,t){return c!==t}),localStorage.setItem("cart",JSON.stringify(a)))}u.calcCartNum(),o.allMoney()}),$("#left").on("click",".allCheck",function(){o.check.forEach(function(e){e.checked=o.aCheck.checked}),o.n=o.aCheck.checked?o.check.length:0,o.allMoney()}),this.check.forEach(function(e){e.onchange=function(){o.checkChange(e)}})}},{key:"checkChange",value:function(e){this.n+=e.checked?1:-1,this.aCheck.checked=this.n===this.check.length,this.allMoney()}},{key:"allMoney",value:function(){var n=0;Array.from(document.querySelectorAll(".check")).forEach(function(e){var t=e.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.firstChild.nextSibling;e.checked&&(n+=Number(t.innerHTML))}),$(".allMoney").html(n.toFixed(2))}}]),e}())})});