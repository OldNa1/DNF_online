"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}require(["require.config"],function(){require(["template","header","footer"],function(r,c){new(function(){function e(){_classCallCheck(this,e),this.init(),this.getType(),this.bindEvents()}return _createClass(e,[{key:"init",value:function(){var e=localStorage.getItem("cart");e?(e=JSON.parse(e),this.render(e)):alert("购物车为空，你也太没牌面了")}},{key:"getType",value:function(){var t=this;$.get(url.rapBaseUrl+"list/type",function(e){1===e.res_code&&t.renderType(e.res_body.list1)})}},{key:"renderType",value:function(e){var t=r("list1-monopoly",{list1:e});$("#commened_com").html(t)}},{key:"render",value:function(e){$("#shop-list").html(r("cart-template",{data:e})),Array.from(document.querySelectorAll("#subtotal")).forEach(function(e){e.innerHTML=Number(e.innerHTML).toFixed(2)})}},{key:"bindEvents",value:function(){$("#left").on("click","#reduceNum",function(e){var t=e.target,r=$(t).next().val();--r<1&&(r=1),$(t).next().val(r);var a=$(t).parent().prev().children("#price").html(),n=Number(r)*Number(a);$(t).parent().next().children("#subtotal").html(n.toFixed(2));var i=localStorage.getItem("cart");i=JSON.parse(i);var l=Number($(t).parent().parent().attr("data-id")),o=-1;i.some(function(e,t){return o=t,e.id===l})&&(i[o].num--,localStorage.setItem("cart",JSON.stringify(i))),c.calcCartNum()}),$("#left").on("click","#addNum",function(e){var t=e.target,r=$(t).prev().val();r++,$(t).prev().val(r);var a=$(t).parent().prev().children("#price").html(),n=Number(r)*Number(a);$(t).parent().next().children("#subtotal").html(n.toFixed(2));var i=localStorage.getItem("cart");i=JSON.parse(i);var l=Number($(t).parent().parent().attr("data-id")),o=-1;i.some(function(e,t){return o=t,e.id===l})&&(i[o].num++,localStorage.setItem("cart",JSON.stringify(i))),c.calcCartNum()}),$("#left").on("click","#delete",function(e){var t=e.target,r=$(t).parent().parent();if(confirm("你真的不要我了吗")){var a=Number($(r).attr("data-id")),n=localStorage.getItem("cart");n=JSON.parse(n);var i=-1;n.some(function(e,t){return i=t,e.id===a})&&($(r).remove(),n=n.filter(function(e,t){return i!==t}),localStorage.setItem("cart",JSON.stringify(n)))}c.calcCartNum()})}}]),e}())})});